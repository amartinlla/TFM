{{extend 'layout.html'}}
{{pass}}

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jqc-1.12.4/jszip-2.5.0/pdfmake-0.1.18/dt-1.10.13/b-1.2.4/b-colvis-1.2.4/b-flash-1.2.4/b-html5-1.2.4/b-print-1.2.4/cr-1.3.2/fc-3.2.2/fh-3.1.2/rr-1.2.0/se-1.2.0/datatables.min.css">
<script src="https://cdn.datatables.net/v/dt/jqc-1.12.4/jszip-2.5.0/pdfmake-0.1.18/dt-1.10.13/b-1.2.4/b-colvis-1.2.4/b-flash-1.2.4/b-html5-1.2.4/b-print-1.2.4/cr-1.3.2/fc-3.2.2/fh-3.1.2/rr-1.2.0/se-1.2.0/datatables.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">


<style>
.dt-buttons{
float:right;
 margin-left:5px;
 margin-bottom:7px;
 }

.dataTables_wrapper{
margin-top:

</style>

<style>
/* Styles for the drop-down. Feel free to change the styles to suit your website. :-) */

.cb-dropdown-wrap {
  max-height: 80px; /* At most, around 3/4 visible items. */
  position: relative;
  height: 19px;
}

.cb-dropdown,
.cb-dropdown li {
  margin: 0;
  padding: 0;
  list-style: none;
}

.cb-dropdown {
  position: absolute;
  z-index: 1;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: #fff;
  border: 1px solid #888;
}

/* For selected filter. */
.active .cb-dropdown {
  background: lightblue;
}

.cb-dropdown-wrap:hover .cb-dropdown {
  height: 80px;
  overflow: auto;
  transition: 0.2s height ease-in-out;
}

/* For selected items. */
.cb-dropdown li.active {
  background: #ff0;
}

.cb-dropdown li label {
  display: block;
  position: relative;
  cursor: pointer;
  line-height: 19px; /* Match height of .cb-dropdown-wrap */
}

.cb-dropdown li label > input {
  position: absolute;
  right: 0;
  top: 0;
  width: 16px;
}

.cb-dropdown li label > span {
  display: block;
  margin-left: 3px;
  margin-right: 20px; /* At least, width of the checkbox. */
  font-family: sans-serif;
  font-size: 0.8em;
  font-weight: normal;
  text-align: left;
}

/* This fixes the vertical aligning of the sorting icon. */
table.dataTable thead .sorting,
table.dataTable thead .sorting_asc,
table.dataTable thead .sorting_desc,
table.dataTable thead .sorting_asc_disabled,
table.dataTable thead .sorting_desc_disabled {
  background-position: 100% 10px;
}
</style>


<h1>Variant Information for filtering and priorizing</h1>
<br></br>

<div class="topnav">
  <button type="button" class="btn btn-primary" onclick="location.href='{{=URL('user/login')}}'">Go HOME</button>
  <button type="button" class="btn btn-primary" onclick="location.href='{{=URL('variants')}}'">VARIANTS</button>
</div>
<br></br>
<table id="all-table" class="display" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th>CHROM</th>
                <th>POS</th>
                <th>CONSEQUENCE</th>
                <th>IMPACT</th>
                <th>CLINVAR</th>
                <th>SYMBOL</th>
                <th>GENE</th>
                <th>FEATURE_TYPE</th>
                <th>FEATURE</th>
                <th>BIOTYPE</th>
                <th>SIFT</th>
                <th>POLYPHEN</th>
                <th>LOFTOOL</th>
                <th>CADD_PHRED</th>
                <th>MAX_FREQ</th>
                <th>AF</th>
                <th>AFR_AF</th>
                <th>AMR_AF</th>
                <th>ASJ_AF</th>
                <th>EAS_AF</th>
                <th>FIN_AF</th>
                <th>NFE_AF</th>
                <th>OTH_AF</th>
                <th>SAS_AF</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th><input type="button" class="column_filter">CHROM</th>
                <th>POS</th>
                <th>CONSEQUENCE</th>
                <th>IMPACT</th>
                <th>CLINVAR</th>
                <th>SYMBOL</th>
                <th>GENE</th>
                <th>FEATURE_TYPE</th>
                <th>FEATURE</th>
                <th>BIOTYPE</th>
                <th>SIFT</th>
                <th>POLYPHEN</th>
                <th>LOFTOOL</th>
                <th>CADD_PHRED</th>
                <th>MAX_FREQ</th>
                <th>AF</th>
                <th>AFR_AF</th>
                <th>AMR_AF</th>
                <th>ASJ_AF</th>
                <th>EAS_AF</th>
                <th>FIN_AF</th>
                <th>NFE_AF</th>
                <th>OTH_AF</th>
                <th>SAS_AF</th>
            </tr>
        </tfoot>
</table>

<br></br>

<h2>
    Filter by position initial and final
</h2>
<br>
<table cellspacing="5" cellpadding="5" border="0">
    <tbody>
        <tr>
            <td>Initial Pos:</td>
            <td><input id="min" name="min" type="text"></td>
            <td>Final Pos:</td>
            <td><input id="max" name="max" type="text"></td>
        </tr>
    </tbody>
</table>

<script>
  /* Custom filtering function which will search data in column four between two values */
$.fn.dataTable.ext.search.push(
    function( settings, data, dataIndex ) {
        var min = parseInt( $('#min').val(), 10 );
        var max = parseInt( $('#max').val(), 10 );
        var pos = parseFloat( data[1] ) || 0; // use data for the pos column
 
        if ( ( isNaN( min ) && isNaN( max ) ) ||
             ( isNaN( min ) && pos <= max ) ||
             ( min <= pos   && isNaN( max ) ) ||
             ( min <= pos   && pos <= max ) )
        {
            return true;
        }
        return false;
    }
);

  $(document).ready(function() {
    function cbDropdown(column) {
		return $('<ul>', {
		  'class': 'cb-dropdown'
		}).appendTo($('<div>', {
		  'class': 'cb-dropdown-wrap'
		}).appendTo(column));
  	}
    var table= $('#all-table').DataTable( {
       data:  {{=results}},
       columns: [
            { data: 'chrom' },
            { data: 'pos' },
            { data: 'consequence' },
            { data: 'impact' },
            { data: 'name' },
            { data: 'symbol' },
            { data: 'gene' },
            { data: 'feature_type' },
            { data: 'feature' },
            { data: 'biotype' },
            { data: 'sift' },
            { data: 'polyphen' },
            { data: 'loftool' },
            { data: 'cadd_phred' },
            { data: 'max_af' },
            { data: 'af' },
            { data: 'afr_af' },
            { data: 'amr_af' },
            { data: 'asj_af' },
            { data: 'eas_af' },
            { data: 'fin_af' },
            { data: 'nfe_af' },
            { data: 'oth_af' },
            { data: 'sas_af' },
        ],
        fixedHeader: {
						   header: true,
					},
	   colReorder: true,
	   fixedColumns:   {
			   leftColumns: 0
						},
	   rowReorder: true,
	   dom: 'Bfrtip',
	   lengthMenu:[
				 [10,25,50,-1],
				 ['10 rows', '25 rows', '50 rows', 'Show all']
		],

		buttons: [
           {
            extend:'pageLength',
            text: '<i class="fa fa-list-ol" aria-hidden="true" style="color:blue">Page Length</i>',
            titleAttr: 'show no.of rows'

            },
    		{
				extend: 'colvis',
				text: '<i class="fa fa-columns" aria-hidden="true" style="color:blue">Fields to show</i>',
				titleAttr: 'Column Visibility',
				exportOptions: {
					columns: ':visible',
				}
            },
		  	{
                extend: 'collection',
                text: 'Export',
                buttons: [
                    'copy',
                    'excel',
                    'csv',
                    'pdf',
                    'print'
                ]
            },
        ],
		//scrollY:        true,
		deferRender:    true,
		scroller:       true,
		//scrollX:        true,
	  	scrollCollapse: true,
       	select:true,
	    initComplete: function() {
		  this.api().columns([0,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]).every(function() {
			var column = this;
			var ddmenu = cbDropdown($(column.footer()).empty() )
			  .on('change', ':checkbox', function() {
				var active;
				var vals = $(':checked', ddmenu).map(function(index, element) {
				  active = true;
				  return $.fn.dataTable.util.escapeRegex($(element).val());
				}).toArray().join('|');

				column
				  .search(vals.length > 0 ? '^(' + vals + ')$' : '', true, false)
				  .draw();

				// Highlight the current item if selected.
				if (this.checked) {
				  $(this).closest('li').addClass('active');
				} else {
				  $(this).closest('li').removeClass('active');
				}

				// Highlight the current filter if selected.
				var active2 = ddmenu.parent().is('.active');
				if (active && !active2) {
				  ddmenu.parent().addClass('active');
				} else if (!active && active2) {
				  ddmenu.parent().removeClass('active');
				}
			  });

			column.data().unique().sort().each(function(d, j) {
			  var // wrapped
				$label = $('<label>'),
				$text = $('<span>', {
				  text: d
				}),
				$cb = $('<input>', {
				  type: 'checkbox',
				  value: d
				});

			  $text.appendTo($label);
			  $cb.appendTo($label);

			  ddmenu.append($('<li>').append($label));
			});
		  });
    }
       } );
       $('#min, #max').keyup( function() {
        table.draw();
        } );
} );

</script>
